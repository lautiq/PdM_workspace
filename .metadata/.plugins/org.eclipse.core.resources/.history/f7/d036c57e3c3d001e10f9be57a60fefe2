/*
 * API_MEF.c
 *
 *  Created on: 16 ago. 2023
 *      Author: lauta
 */


#include <API_chronos.h>
#include "API_SSD1306.h"
#include "API_debounce.h"
#include "API_delay.h"


//Private variables
static FSM_State currentState;
static delay_t displayUpdateDelay;
static bool_t startButtonPressed = false;

//Private functions
static void displayTime(uint32_t time);



//Implementation of API_MEF functions

/*
 * @brief Initializes the Finite State Machine (FSM) for the chronometer
 */
void MEF_Init()
{
	oledInit();
	oledSetCursor(0,0);
	updateScreen();

	currentState  = STATE_INIT;
	delayInit(&displayUpdateDelay, DISPLAY_UPDATE_TIME_MS);

	debounceFSM_init();
}

void MEF_Update()
{
	debounceFSM_update();

	switch(currentState)
	{
	case STATE_INIT:
		oledSetCursor(0, 0);
		oledWriteString("Hold", White);
		updateScreen();

		if(debounceFSM_readKey())
		{
			currentState = START;
			oledSetCursor(0,20);
			oledWriteString("00.00.00", White);
			updateScreen();
		}
	break;


	case STATE_START:
		if(debounceFSM_readKey()){
			startButtonPressed = true;
		}

		if(startButtonPressed )
		{
			uint32_t elapsedMillis = HAL_GetTick();
			displayTime(elapsedMilles);
			updateScreen();
		}

		if(debounceFSM_ReadKey())

	break;



	}
}









